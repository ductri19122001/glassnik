generator client {
  provider        = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
 
}

model Capability {
  id                Int                   @id @default(autoincrement())
  name              String                @unique @db.VarChar(100)
  iconUrl           String?               @map("icon_url")
  badgeType         CapabilityBadgeType   @map("badge_type")
  minAmount         Decimal?              @map("min_amount") @db.Decimal(10, 2)
  minMonths         Int?                  @map("min_months")
  isActive          Boolean?              @default(true) @map("is_active")
  createdAt         DateTime?             @default(now()) @map("created_at") @db.Timestamp(6)
  userCapabilities  UserCapability[]

  @@map("capabilities")
}

model CapabilityApplication {
  id              Int           @id @default(autoincrement())
  userId          Int           @map("user_id")
  capabilityCode  String        @map("capability_code") @db.VarChar(100)
  status          CommonStatus  @default(PENDING)
  reviewerId      Int?          @map("reviewer_id")
  notes           String?
  createdAt       DateTime?     @default(now()) @map("created_at") @db.Timestamp(6)
  reviewedAt      DateTime?     @map("reviewed_at") @db.Timestamp(6)
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_cap_app_user")

  @@map("capability_applications")
  @@index([userId], map: "idx_capability_applications_user_id")
}

model Subscription {
  id         Int       @id @default(autoincrement())
  userId     Int       @map("user_id")
  planCode   String    @map("plan_code") @db.VarChar(100)
  status     String    @db.VarChar(50)
  startedAt  DateTime? @map("started_at") @db.Timestamp(6)
  endedAt    DateTime? @map("ended_at") @db.Timestamp(6)
  user       User      @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_subscription_user")

  @@map("subscriptions")
}

model UserCapability {
  id                 Int           @id @default(autoincrement())
  userId             Int           @map("user_id")
  capabilityId       Int           @map("capability_id")
  status             CommonStatus
  grantedDatetimeby  DateTime?     @map("granted_datetimeby") @db.Timestamp(6)
  grantedAt          DateTime?     @default(now()) @map("granted_at") @db.Timestamp(6)
  expiresAt          DateTime?     @map("expires_at") @db.Timestamp(6)
  capability         Capability    @relation(fields: [capabilityId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_user_cap_capability")
  user               User          @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_user_cap_user")

  @@map("user_capabilities")
  @@unique([userId, capabilityId], map: "uq_user_capability")
  @@index([capabilityId], map: "idx_user_capabilities_capability_id")
  @@index([userId], map: "idx_user_capabilities_user_id")
}

model User {
  id                      Int                       @id @default(autoincrement())
  email                   String                    @unique @db.VarChar(255)
  username                String?                   @unique @db.VarChar(100)
  displayName             String?                   @map("display_name") @db.VarChar(150)
  avatarUrl               String?                   @map("avatar_varcharurl")
  status                  String?                   @default("ACTIVE") @db.VarChar(50)
  createdAt               DateTime?                 @default(now()) @map("created_at") @db.Timestamp(6)
  updatedAt               DateTime?                 @default(now()) @map("updated_at") @db.Timestamp(6)
  capabilityApplications  CapabilityApplication[]
  subscriptions           Subscription[]
  userCapabilities        UserCapability[]
  videoAssets             VideoAsset[]

  @@map("users")
}

model VideoAsset {
  id                  Int       @id @default(autoincrement())
  ownerId             Int       @map("owner_id")
  source              String?   @db.VarChar(50)
  eligibleForStitch   Boolean?  @default(false) @map("eligible_for_stitch")
  status              String?   @db.VarChar(50)
  createdAt           DateTime? @default(now()) @map("created_at") @db.Timestamp(6)
  owner               User      @relation(fields: [ownerId], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_video_owner")

  @@map("video_assets")
  @@index([ownerId], map: "idx_video_assets_owner")
}

enum CapabilityBadgeType {
  SYSTEM
  SUBSCRIPTION
  APPLICATION

  @@map("capability_badge_type")
}

enum CommonStatus {
  PENDING
  ACTIVE
  APPROVED
  REJECTED
  REVOKED
  EXPIRED

  @@map("common_status")
}
